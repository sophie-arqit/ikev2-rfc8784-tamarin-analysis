<?xml version="1.0"?>
<!-- CPSA 4.4.3 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>IKEv2-PSK</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(comment &quot;CPSA 4.4.3&quot;)
(comment &quot;Extracted shapes&quot;)
(herald IKEv2-PSK (algebra diffie-hellman))
(comment &quot;CPSA 4.4.3&quot;)
(comment &quot;All input read from rfc8784_ss.scm&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t6">6</a> <a href="#t20">20</a> <a href="#t30">30</a> <a href="#t36">36</a> <a href="#t40">40</a> <a href="#t46">46</a> <a href="#t52">52</a> <a href="#t58">58</a> <a href="#t62">62</a> <a href="#t66">66</a> <a href="#t72">72</a> <a href="#t76">76</a> <a href="#t90">90</a> <a href="#t100">100</a>.</p>

<p id="t0">Tree <a href="#top">0</a>, POV <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k4&quot;, &quot;_self&quot;)'>4</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k4">4</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='39.960' y='39.960' style='text-anchor: middle;'>ikev2_psk 0</text>
  </svg></div>

<pre>(defskeleton ikev2_psk
  (vars (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 data)
    (psk ppk skey) (ID_init id_ppk ID_resp name) (i r rndx))
  (defstrand init-rc 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2)
  (comment &quot;analyse IKE_SA from the initiator&apos;s perspective&quot;)
  (label 0)
  (unrealized (0 3))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k4">Item <a href="#t0">4</a>, Parent: <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>ikev2_psk 4</text>
  </svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 SPI_init2-0
      SPI_resp2-0 data) (psk ppk skey) (ID_init id_ppk ID_resp1 name)
    (r i rndx))
  (defstrand init-rc 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))
  (defstrand resp-cr 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2-0)
  (facts (peerID 0 ID_resp1) (pskIDs psk ID_init ID_resp1)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (1 2))
  (label 4)
  (parent 0)
  (realized)
  (shape)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
        (ID_resp ID_resp1) (i i) (r r))))
  (origs))</pre>

<p id="t6">Tree <a href="#top">6</a>, POV <a href="#k6">6</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k14&quot;, &quot;_self&quot;)'>14</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k6&quot;, &quot;_self&quot;)'>6</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k6">Item <a href="#t6">6</a>, Child: <a href="#k14">14</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='39.960' y='39.960' style='text-anchor: middle;'>ikev2_psk 6</text>
  </svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i rki cci r rkr ccr rndx))
  (defstrand init-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r))
    (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki)
    (cci cci))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
    ncc_init)
  (comment
    &quot;analyse rekey then create child from the initiator&apos;s perspective&quot;)
  (label 6)
  (unrealized (0 3) (0 7))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k14">Item <a href="#t6">14</a>, Parent: <a href="#k6">6</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 639.960 Q 92.940 639.960 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <path
   d='M 139.920 489.960 Q 92.940 489.960 45.960 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr-0) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr-0)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) (mul rkr (rec rkr-0) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) (mul rkr (rec rkr-0) rki))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <path
   d='M 39.960 564.960 Q 86.940 564.960 133.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <path
   d='M 39.960 414.960 Q 86.940 414.960 133.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) (mul rkr (rec rkr-0) rki))) (gcci (exp (gen) cci)) (r r) (rkr rkr-0) (ccr ccr))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 14</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (ppk psk skey)
    (ID_init ID_resp id_ppk name) (rkr rkr-0 ccr r i rki cci rndx))
  (defstrand init-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r))
    (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki)
    (cci cci))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) (mul rkr (rec rkr-0) rki))) (gcci (exp (gen) cci))
    (r r) (rkr rkr-0) (ccr ccr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((0 6) (1 6))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 7) (0 7)))
  (non-orig ppk psk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 nrk_init nrk_resp
    SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init ncc_resp
    SPI_resp2-0)
  (facts (peerID 0 ID_resp) (pskIDs psk ID_init ID_resp)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-rc 7)
    (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init-0
      (exp (gen) cci-0)
      (hash
        (cat
          (hash
            (prf ppk
              (hash
                (cat (prf (cat n_init n_resp) (exp (gen) (mul i-0 r)))
                  n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
            (exp (gen) (mul rki-0 rkr)) nrk_init nrk_resp) nrk_init
          nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (1 6))
  (label 14)
  (parent 6)
  (realized)
  (shape)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
        (id_ppk id_ppk) (ID_resp ID_resp) (i i) (rki rki) (cci cci)
        (r r) (rkr rkr) (ccr ccr) (ncc_init ncc_init)
        (ncc_resp ncc_resp))))
  (origs))</pre>

<p id="t20">Tree <a href="#top">20</a>, POV <a href="#k20">20</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k26&quot;, &quot;_self&quot;)'>26</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k20&quot;, &quot;_self&quot;)'>20</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k20">Item <a href="#t20">20</a>, Child: <a href="#k26">26</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 20</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i rki cci r rkr ccr rndx))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
    ncc_resp)
  (comment
    &quot;analyse rekey then create child from the responder&apos;s perspective&quot;)
  (label 20)
  (unrealized (0 2) (0 6))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k26">Item <a href="#t20">26</a>, Parent: <a href="#k20">20</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 564.960 Q 92.940 564.960 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) (mul rki rkr (rec rki-0))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) (mul rki rkr (rec rki-0)))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki-0) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki-0)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 86.940 489.960 133.920 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 86.940 339.960 133.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (ncc_init ncc_init) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) (mul rki rkr (rec rki-0)))) (i i) (rki rki-0) (cci cci))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 26</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (ppk psk skey)
    (ID_resp ID_init id_ppk name) (rki rkr ccr rki-0 cci i r rndx))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (defstrand init-rc 7 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (ncc_init ncc_init) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk)
    (gr (exp (gen) r)) (grkr (exp (gen) (mul rki rkr (rec rki-0))))
    (i i) (rki rki-0) (cci cci))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((0 5) (1 5)) ((1 0) (0 0))
    ((1 2) (0 2)) ((1 4) (0 4)) ((1 6) (0 6)))
  (non-orig ppk psk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 nrk_init nrk_resp
    SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init ncc_resp
    SPI_init2-0)
  (facts (peerID 1 ID_resp) (pskIDs psk ID_init ID_resp)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 resp-cr 4)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r)
      n_resp &quot;notify_useppk&quot; n_init
      (hmac ID_resp
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init
              n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) (1 3))
  (label 26)
  (parent 20)
  (realized)
  (shape)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
        (id_ppk id_ppk) (ID_resp ID_resp) (i i) (rki rki) (cci cci)
        (r r) (rkr rkr) (ccr ccr) (ncc_init ncc_init)
        (ncc_resp ncc_resp))))
  (origs))</pre>

<p id="t30">Tree <a href="#top">30</a>, POV <a href="#k30">30</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k34&quot;, &quot;_self&quot;)'>34</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k30&quot;, &quot;_self&quot;)'>30</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k30">Item <a href="#t30">30</a>, Child: <a href="#k34">34</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 30</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i rki cci r rkr ccr rndx))
  (defstrand init-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r))
    (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki)
    (cci cci))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
    ncc_init)
  (comment
    &quot;analyse create child then rekey from the initiator&apos;s perspective&quot;)
  (label 30)
  (unrealized (0 3))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k34">Item <a href="#t30">34</a>, Parent: <a href="#k30">30</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 34</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (psk ppk skey)
    (ID_init id_ppk ID_resp1 name) (rki cci rkr ccr r i rndx))
  (defstrand init-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r))
    (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki)
    (cci cci))
  (defstrand resp-cr 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 nrk_init
    SPIrk_init SPIcc_init ncc_init SPI_resp2-0)
  (facts (peerID 0 ID_resp1) (pskIDs psk ID_init ID_resp1)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (1 2))
  (label 34)
  (parent 30)
  (realized)
  (shape)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
        (id_ppk id_ppk) (ID_resp ID_resp1) (i i) (rki rki) (cci cci)
        (r r) (rkr rkr) (ccr ccr) (ncc_init ncc_init)
        (ncc_resp ncc_resp))))
  (origs))</pre>

<p id="t36">Tree <a href="#top">36</a>, POV <a href="#k36">36</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k38&quot;, &quot;_self&quot;)'>38</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k36&quot;, &quot;_self&quot;)'>36</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k36">Item <a href="#t36">36</a>, Child: <a href="#k38">38</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 36</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i rki cci r rkr ccr rndx))
  (defstrand resp-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
    ncc_resp)
  (comment
    &quot;analyse create child then rekey from the responder&apos;s perspective&quot;)
  (label 36)
  (unrealized (0 2))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k38">Item <a href="#t36">38</a>, Parent: <a href="#k36">36</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 38</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 data) (psk ppk skey)
    (ID_init ID_resp id_ppk name) (rki cci r rkr ccr i rndx))
  (defstrand resp-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (defstrand init-cr 3 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk)
    (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r))
    (i i))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 nrk_resp
    SPIrk_resp SPIcc_resp ncc_resp SPI_init2-0)
  (facts (peerID 1 ID_resp) (isKeyIDFor id_ppk ppk)
    (pskIDs psk ID_init ID_resp))
  (rule fact-init-cr-isKeyIDFor0 fact-resp-cr-isKeyIDFor0
    fact-resp-cr-pskIDs1 id_ppk_inj2 peerID_intro_cr)
  (operation encryption-test (added-strand init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (0 2))
  (label 38)
  (parent 36)
  (realized)
  (shape)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
        (id_ppk id_ppk) (ID_resp ID_resp) (i i) (rki rki) (cci cci)
        (r r) (rkr rkr) (ccr ccr) (ncc_init ncc_init)
        (ncc_resp ncc_resp))))
  (origs))</pre>

<p id="t40">Tree <a href="#top">40</a>, POV <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k44&quot;, &quot;_self&quot;)'>44</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k40&quot;, &quot;_self&quot;)'>40</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k40">Item <a href="#t40">40</a>, Child: <a href="#k44">44</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 40</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 data)
    (psk ppk skey) (ID_init id_ppk ID_resp name) (i r rndx))
  (defstrand init-rc 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2)
  (goals
    (forall
      ((SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 data)
        (psk ppk skey) (ID_init id_ppk ID_resp name) (i r rndx)
        (z strd))
      (implies
        (and (p &quot;init-rc&quot; z 4) (p &quot;init-rc&quot; &quot;SPI_init&quot; z SPI_init)
          (p &quot;init-rc&quot; &quot;SPI_resp&quot; z SPI_resp)
          (p &quot;init-rc&quot; &quot;n_init&quot; z n_init)
          (p &quot;init-rc&quot; &quot;n_resp&quot; z n_resp)
          (p &quot;init-rc&quot; &quot;SPI_init2&quot; z SPI_init2)
          (p &quot;init-rc&quot; &quot;SPI_resp2&quot; z SPI_resp2)
          (p &quot;init-rc&quot; &quot;psk&quot; z psk) (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp)
          (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;gr&quot; z (exp (gen) r)) (p &quot;init-rc&quot; &quot;i&quot; z i)
          (non psk) (non ppk) (ugen SPI_init) (ugen n_init)
          (ugen SPI_init2))
        (or
          (exists ((SPI_init2-0 SPI_resp2-0 data) (z-0 strd))
            (and (p &quot;resp-rc&quot; z-0 4)
              (p &quot;resp-rc&quot; &quot;SPI_init&quot; z-0 SPI_init)
              (p &quot;resp-rc&quot; &quot;SPI_resp&quot; z-0 SPI_resp)
              (p &quot;resp-rc&quot; &quot;n_init&quot; z-0 n_init)
              (p &quot;resp-rc&quot; &quot;n_resp&quot; z-0 n_resp)
              (p &quot;resp-rc&quot; &quot;SPI_init2&quot; z-0 SPI_init2-0)
              (p &quot;resp-rc&quot; &quot;SPI_resp2&quot; z-0 SPI_resp2-0)
              (p &quot;resp-rc&quot; &quot;psk&quot; z-0 psk) (p &quot;resp-rc&quot; &quot;ppk&quot; z-0 ppk)
              (p &quot;resp-rc&quot; &quot;ID_init&quot; z-0 ID_init)
              (p &quot;resp-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)
              (p &quot;resp-rc&quot; &quot;id_ppk&quot; z-0 id_ppk)
              (p &quot;resp-rc&quot; &quot;gi&quot; z-0 (exp (gen) i))
              (p &quot;resp-rc&quot; &quot;r&quot; z-0 r) (prec z 0 z-0 0) (prec z 2 z-0 2)
              (prec z-0 1 z 1) (prec z-0 3 z 3) (ugen SPI_resp)
              (ugen n_resp) (ugen SPI_resp2-0) (fact peerID z ID_resp)
              (fact pskIDs psk ID_init ID_resp)
              (fact isKeyIDFor id_ppk ppk)))
          (exists ((SPI_init2-0 SPI_resp2-0 data) (z-0 strd))
            (and (p &quot;resp-cr&quot; z-0 4)
              (p &quot;resp-cr&quot; &quot;SPI_init&quot; z-0 SPI_init)
              (p &quot;resp-cr&quot; &quot;SPI_resp&quot; z-0 SPI_resp)
              (p &quot;resp-cr&quot; &quot;n_init&quot; z-0 n_init)
              (p &quot;resp-cr&quot; &quot;n_resp&quot; z-0 n_resp)
              (p &quot;resp-cr&quot; &quot;SPI_init2&quot; z-0 SPI_init2-0)
              (p &quot;resp-cr&quot; &quot;SPI_resp2&quot; z-0 SPI_resp2-0)
              (p &quot;resp-cr&quot; &quot;psk&quot; z-0 psk) (p &quot;resp-cr&quot; &quot;ppk&quot; z-0 ppk)
              (p &quot;resp-cr&quot; &quot;ID_init&quot; z-0 ID_init)
              (p &quot;resp-cr&quot; &quot;ID_resp&quot; z-0 ID_resp)
              (p &quot;resp-cr&quot; &quot;id_ppk&quot; z-0 id_ppk)
              (p &quot;resp-cr&quot; &quot;gi&quot; z-0 (exp (gen) i))
              (p &quot;resp-cr&quot; &quot;r&quot; z-0 r) (prec z 0 z-0 0) (prec z 2 z-0 2)
              (prec z-0 1 z 1) (prec z-0 3 z 3) (ugen SPI_resp)
              (ugen n_resp) (ugen SPI_resp2-0) (fact peerID z ID_resp)
              (fact pskIDs psk ID_init ID_resp)
              (fact isKeyIDFor id_ppk ppk)))))))
  (label 40)
  (unrealized (0 3))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k44">Item <a href="#t40">44</a>, Parent: <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 44</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 SPI_init2-0
      SPI_resp2-0 data) (psk ppk skey) (ID_init id_ppk ID_resp1 name)
    (r i rndx))
  (defstrand init-rc 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))
  (defstrand resp-cr 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2-0)
  (facts (peerID 0 ID_resp1) (pskIDs psk ID_init ID_resp1)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (1 2))
  (label 44)
  (parent 40)
  (realized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
        (ID_resp ID_resp1) (i i) (r r))))
  (origs))</pre>

<p id="t46">Tree <a href="#top">46</a>, POV <a href="#k46">46</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k50&quot;, &quot;_self&quot;)'>50</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k46&quot;, &quot;_self&quot;)'>46</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k46">Item <a href="#t46">46</a>, Child: <a href="#k50">50</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr gr) (grkr grkr) (i i) (rki rki))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 46</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp data) (psk ppk skey)
    (ID_resp ID_init id_ppk name) (gr grkr base) (i rki rndx))
  (defstrand init-rc 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr gr)
    (grkr grkr) (i i) (rki rki))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init)
  (goals
    (forall ((ID_resp name) (z strd))
      (implies (and (p &quot;init-rc&quot; z 6) (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (or
          (exists ((z-0 strd))
            (and (p &quot;resp-rc&quot; z-0 5)
              (p &quot;resp-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)))
          (exists ((z-0 strd))
            (and (p &quot;resp-cr&quot; z-0 7)
              (p &quot;resp-cr&quot; &quot;ID_resp&quot; z-0 ID_resp)))))))
  (comment
    &quot;Aliveness when rekeying with resp-rc or resp-cr from perspective of init-rc&quot;)
  (label 46)
  (unrealized (0 3))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k50">Item <a href="#t46">50</a>, Parent: <a href="#k46">46</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr grkr) (i i) (rki rki))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 50</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPI_init2-0 SPI_resp2-0 data)
    (psk ppk skey) (ID_init id_ppk ID_resp1 name) (grkr base)
    (rki r i rndx))
  (defstrand init-rc 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk)
    (gr (exp (gen) r)) (grkr grkr) (i i) (rki rki))
  (defstrand resp-cr 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 nrk_init
    SPIrk_init SPI_resp2-0)
  (facts (peerID 0 ID_resp1) (pskIDs psk ID_init ID_resp1)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (1 2))
  (label 50)
  (parent 46)
  (realized)
  (shape)
  (satisfies (no (p &quot;resp-rc&quot; z-0 (idx 5)) (ID_resp ID_resp1) (z 0)))
  (maps
    ((0)
      ((ID_resp ID_resp1) (i i) (rki rki) (SPI_init SPI_init)
        (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
        (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init)
        (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (gr (exp (gen) r)) (grkr grkr) (psk psk)
        (ppk ppk) (ID_init ID_init) (id_ppk id_ppk))))
  (origs))</pre>

<p id="t52">Tree <a href="#top">52</a>, POV <a href="#k52">52</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k56&quot;, &quot;_self&quot;)'>56</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k52&quot;, &quot;_self&quot;)'>52</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k52">Item <a href="#t52">52</a>, Child: <a href="#k56">56</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr gr) (grkr grkr) (gccr gccr) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 52</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_resp ID_init id_ppk name)
    (gr grkr gccr base) (i rki cci rndx))
  (defstrand init-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr gr) (grkr grkr) (gccr gccr)
    (i i) (rki rki) (cci cci))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
    ncc_init)
  (goals
    (forall ((ID_resp name) (z strd))
      (implies (and (p &quot;init-cr&quot; z 8) (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (or
          (exists ((z-0 strd))
            (and (p &quot;resp-rc&quot; z-0 5)
              (p &quot;resp-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)))
          (exists ((z-0 strd))
            (and (p &quot;resp-cr&quot; z-0 7)
              (p &quot;resp-cr&quot; &quot;ID_resp&quot; z-0 ID_resp)))))))
  (comment
    &quot;Aliveness when rekeying with resp-rc or resp-cr from perspective of init-cr&quot;)
  (label 52)
  (unrealized (0 3))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k56">Item <a href="#t52">56</a>, Parent: <a href="#k52">52</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp grkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr grkr) (gccr gccr) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 56</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (psk ppk skey)
    (ID_init id_ppk ID_resp1 name) (grkr gccr base) (rki cci r i rndx))
  (defstrand init-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr grkr)
    (gccr gccr) (i i) (rki rki) (cci cci))
  (defstrand resp-cr 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 nrk_init
    SPIrk_init SPIcc_init ncc_init SPI_resp2-0)
  (facts (peerID 0 ID_resp1) (pskIDs psk ID_init ID_resp1)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (1 2))
  (label 56)
  (parent 52)
  (realized)
  (shape)
  (satisfies (no (p &quot;resp-rc&quot; z-0 (idx 5)) (ID_resp ID_resp1) (z 0)))
  (maps
    ((0)
      ((ID_resp ID_resp1) (i i) (rki rki) (cci cci) (SPI_init SPI_init)
        (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
        (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init)
        (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
        (gr (exp (gen) r)) (grkr grkr) (gccr gccr) (psk psk) (ppk ppk)
        (ID_init ID_init) (id_ppk id_ppk))))
  (origs))</pre>

<p id="t58">Tree <a href="#top">58</a>, POV <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k60&quot;, &quot;_self&quot;)'>60</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k58&quot;, &quot;_self&quot;)'>58</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k58">Item <a href="#t58">58</a>, Child: <a href="#k60">60</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi gi) (grki grki) (r r) (rkr rkr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 58</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp data) (psk ppk skey)
    (ID_init ID_resp id_ppk name) (gi grki base) (r rkr rndx))
  (defstrand resp-rc 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi gi)
    (grki grki) (r r) (rkr rkr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp)
  (goals
    (forall ((ID_init name) (z strd))
      (implies (and (p &quot;resp-rc&quot; z 6) (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init))
        (or
          (exists ((z-0 strd))
            (and (p &quot;init-rc&quot; z-0 5)
              (p &quot;init-rc&quot; &quot;ID_init&quot; z-0 ID_init)))
          (exists ((z-0 strd))
            (and (p &quot;init-cr&quot; z-0 7)
              (p &quot;init-cr&quot; &quot;ID_init&quot; z-0 ID_init)))))))
  (comment
    &quot;Aliveness when rekeying with init-rc from perspective of resp-rc&quot;)
  (label 58)
  (unrealized (0 2))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k60">Item <a href="#t58">60</a>, Parent: <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki grki) (r r) (rkr rkr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 60</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPI_init2-0 data) (psk ppk skey)
    (ID_init ID_resp id_ppk name) (grki base) (r rkr i rndx))
  (defstrand resp-rc 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk)
    (gi (exp (gen) i)) (grki grki) (r r) (rkr rkr))
  (defstrand init-cr 3 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk)
    (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r))
    (i i))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 nrk_resp
    SPIrk_resp SPI_init2-0)
  (facts (peerID 1 ID_resp) (isKeyIDFor id_ppk ppk)
    (pskIDs psk ID_init ID_resp))
  (rule fact-init-cr-isKeyIDFor0 fact-resp-cr-isKeyIDFor0
    fact-resp-cr-pskIDs1 id_ppk_inj2 peerID_intro_cr)
  (operation encryption-test (added-strand init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (0 2))
  (label 60)
  (parent 58)
  (realized)
  (shape)
  (satisfies (no (p &quot;init-rc&quot; z-0 (idx 5)) (ID_init ID_init) (z 0)))
  (maps
    ((0)
      ((ID_init ID_init) (r r) (rkr rkr) (SPI_init SPI_init)
        (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
        (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init)
        (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (gi (exp (gen) i)) (grki grki) (psk psk)
        (ppk ppk) (ID_resp ID_resp) (id_ppk id_ppk))))
  (origs))</pre>

<p id="t62">Tree <a href="#top">62</a>, POV <a href="#k62">62</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k64&quot;, &quot;_self&quot;)'>64</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k62&quot;, &quot;_self&quot;)'>62</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k62">Item <a href="#t62">62</a>, Child: <a href="#k64">64</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi gi) (grki grki) (gcci gcci) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 62</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init ID_resp id_ppk name)
    (gi grki gcci base) (r rkr ccr rndx))
  (defstrand resp-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi gi) (grki grki) (gcci gcci)
    (r r) (rkr rkr) (ccr ccr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
    ncc_resp)
  (goals
    (forall ((ID_init name) (z strd))
      (implies (and (p &quot;resp-cr&quot; z 8) (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init))
        (or
          (exists ((z-0 strd))
            (and (p &quot;init-rc&quot; z-0 5)
              (p &quot;init-rc&quot; &quot;ID_init&quot; z-0 ID_init)))
          (exists ((z-0 strd))
            (and (p &quot;init-cr&quot; z-0 7)
              (p &quot;init-cr&quot; &quot;ID_init&quot; z-0 ID_init)))))))
  (comment
    &quot;Aliveness when rekeying with init-rc from perspective of resp-cr&quot;)
  (label 62)
  (unrealized (0 2))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k64">Item <a href="#t62">64</a>, Parent: <a href="#k62">62</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki grki) (gcci gcci) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 64</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 data) (psk ppk skey)
    (ID_init ID_resp id_ppk name) (grki gcci base) (r rkr ccr i rndx))
  (defstrand resp-cr 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki grki)
    (gcci gcci) (r r) (rkr rkr) (ccr ccr))
  (defstrand init-cr 3 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk)
    (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r))
    (i i))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 nrk_resp
    SPIrk_resp SPIcc_resp ncc_resp SPI_init2-0)
  (facts (peerID 1 ID_resp) (isKeyIDFor id_ppk ppk)
    (pskIDs psk ID_init ID_resp))
  (rule fact-init-cr-isKeyIDFor0 fact-resp-cr-isKeyIDFor0
    fact-resp-cr-pskIDs1 id_ppk_inj2 peerID_intro_cr)
  (operation encryption-test (added-strand init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (0 2))
  (label 64)
  (parent 62)
  (realized)
  (shape)
  (satisfies (no (p &quot;init-rc&quot; z-0 (idx 5)) (ID_init ID_init) (z 0)))
  (maps
    ((0)
      ((ID_init ID_init) (r r) (rkr rkr) (ccr ccr) (SPI_init SPI_init)
        (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
        (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init)
        (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
        (gi (exp (gen) i)) (grki grki) (gcci gcci) (psk psk) (ppk ppk)
        (ID_resp ID_resp) (id_ppk id_ppk))))
  (origs))</pre>

<p id="t66">Tree <a href="#top">66</a>, POV <a href="#k66">66</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k70&quot;, &quot;_self&quot;)'>70</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k66&quot;, &quot;_self&quot;)'>66</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k66">Item <a href="#t66">66</a>, Child: <a href="#k70">70</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr gr) (gccr gccr) (i i) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 66</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 SPIcc_init
      SPIcc_resp ncc_init ncc_resp data) (psk ppk skey)
    (ID_resp ID_init id_ppk name) (gr gccr base) (i cci rndx))
  (defstrand init-cr 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init)
    (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
    (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp)
    (id_ppk id_ppk) (gr gr) (gccr gccr) (i i) (cci cci))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2 SPIcc_init ncc_init)
  (goals
    (forall ((ID_resp name) (z strd))
      (implies (and (p &quot;init-cr&quot; z 6) (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (or
          (exists ((z-0 strd))
            (and (p &quot;resp-rc&quot; z-0 7)
              (p &quot;resp-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)))
          (exists ((z-0 strd))
            (and (p &quot;resp-cr&quot; z-0 5)
              (p &quot;resp-cr&quot; &quot;ID_resp&quot; z-0 ID_resp)))))))
  (comment
    &quot;Non-aliveness when create child before rekeying from init-cr&apos;s perspective&quot;)
  (label 66)
  (unrealized (0 3))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k70">Item <a href="#t66">70</a>, Parent: <a href="#k66">66</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp gccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp1 (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp1 (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1) (id_ppk id_ppk) (gr (exp (gen) r)) (gccr gccr) (i i) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 70</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 SPIcc_init
      SPIcc_resp ncc_init ncc_resp SPI_init2-0 SPI_resp2-0 data)
    (psk ppk skey) (ID_init id_ppk ID_resp1 name) (gccr base)
    (cci r i rndx))
  (defstrand init-cr 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init)
    (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
    (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp1)
    (id_ppk id_ppk) (gr (exp (gen) r)) (gccr gccr) (i i) (cci cci))
  (defstrand resp-cr 4 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp1) (id_ppk id_ppk) (gi (exp (gen) i)) (r r))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 SPIcc_init
    ncc_init SPI_resp2-0)
  (facts (peerID 0 ID_resp1) (pskIDs psk ID_init ID_resp1)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (1 2))
  (label 70)
  (parent 66)
  (realized)
  (shape)
  (satisfies (no (p &quot;resp-rc&quot; z-0 (idx 7)) (ID_resp ID_resp1) (z 0)))
  (maps
    ((0)
      ((ID_resp ID_resp1) (i i) (cci cci) (SPI_init SPI_init)
        (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
        (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp)
        (ncc_init ncc_init) (ncc_resp ncc_resp) (gr (exp (gen) r))
        (gccr gccr) (psk psk) (ppk ppk) (ID_init ID_init)
        (id_ppk id_ppk))))
  (origs))</pre>

<p id="t72">Tree <a href="#top">72</a>, POV <a href="#k72">72</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k74&quot;, &quot;_self&quot;)'>74</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k72&quot;, &quot;_self&quot;)'>72</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k72">Item <a href="#t72">72</a>, Child: <a href="#k74">74</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi gi) (gcci gcci) (r r) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 72</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 SPIcc_init
      SPIcc_resp ncc_init ncc_resp data) (psk ppk skey)
    (ID_init ID_resp id_ppk name) (gi gcci base) (r ccr rndx))
  (defstrand resp-cr 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init)
    (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
    (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp)
    (id_ppk id_ppk) (gi gi) (gcci gcci) (r r) (ccr ccr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 SPIcc_resp ncc_resp)
  (goals
    (forall ((ID_init name) (z strd))
      (implies (and (p &quot;resp-cr&quot; z 6) (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init))
        (or
          (exists ((z-0 strd))
            (and (p &quot;init-rc&quot; z-0 7)
              (p &quot;init-rc&quot; &quot;ID_init&quot; z-0 ID_init)))
          (exists ((z-0 strd))
            (and (p &quot;init-cr&quot; z-0 5)
              (p &quot;init-cr&quot; &quot;ID_init&quot; z-0 ID_init)))))))
  (comment
    &quot;Aliveness when rekeying with init-rc from perspective of resp-cr&quot;)
  (label 72)
  (unrealized (0 2))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k74">Item <a href="#t72">74</a>, Parent: <a href="#k72">72</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r)) (i i))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-cr</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (gcci gcci) (r r) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-cr</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 74</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 SPIcc_init
      SPIcc_resp ncc_init ncc_resp SPI_init2-0 data) (psk ppk skey)
    (ID_init ID_resp id_ppk name) (gcci base) (r ccr i rndx))
  (defstrand resp-cr 6 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (SPIcc_init SPIcc_init)
    (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
    (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp)
    (id_ppk id_ppk) (gi (exp (gen) i)) (gcci gcci) (r r) (ccr ccr))
  (defstrand init-cr 3 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (psk psk)
    (ppk ppk) (ID_init ID_init) (id_ppk id_ppk) (gr (exp (gen) r))
    (i i))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)))
  (non-orig psk ppk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 SPIcc_resp
    ncc_resp SPI_init2-0)
  (facts (peerID 1 ID_resp) (isKeyIDFor id_ppk ppk)
    (pskIDs psk ID_init ID_resp))
  (rule fact-init-cr-isKeyIDFor0 fact-resp-cr-isKeyIDFor0
    fact-resp-cr-pskIDs1 id_ppk_inj2 peerID_intro_cr)
  (operation encryption-test (added-strand init-cr 3)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;)
      (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
        &quot;notify_useppk&quot;) n_resp
      (hmac ID_init
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init
              n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) (0 2))
  (label 74)
  (parent 72)
  (realized)
  (shape)
  (satisfies (no (p &quot;init-rc&quot; z-0 (idx 7)) (ID_init ID_init) (z 0)))
  (maps
    ((0)
      ((ID_init ID_init) (r r) (ccr ccr) (SPI_init SPI_init)
        (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
        (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp)
        (ncc_init ncc_init) (ncc_resp ncc_resp) (gi (exp (gen) i))
        (gcci gcci) (psk psk) (ppk ppk) (ID_resp ID_resp)
        (id_ppk id_ppk))))
  (origs))</pre>

<p id="t76">Tree <a href="#top">76</a>, POV <a href="#k76">76</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k84&quot;, &quot;_self&quot;)'>84</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k76&quot;, &quot;_self&quot;)'>76</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k76">Item <a href="#t76">76</a>, Child: <a href="#k84">84</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 76</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i rki cci r rkr ccr rndx))
  (defstrand init-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r))
    (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki)
    (cci cci))
  (non-orig psk ppk)
  (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
    ncc_init)
  (goals
    (forall
      ((SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
         nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
         ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
        (i rki cci r rkr ccr rndx) (z strd))
      (implies
        (and (p &quot;init-rc&quot; z 8) (p &quot;init-rc&quot; &quot;SPI_init&quot; z SPI_init)
          (p &quot;init-rc&quot; &quot;SPI_resp&quot; z SPI_resp)
          (p &quot;init-rc&quot; &quot;n_init&quot; z n_init)
          (p &quot;init-rc&quot; &quot;n_resp&quot; z n_resp)
          (p &quot;init-rc&quot; &quot;SPI_init2&quot; z SPI_init2)
          (p &quot;init-rc&quot; &quot;SPI_resp2&quot; z SPI_resp2)
          (p &quot;init-rc&quot; &quot;nrk_init&quot; z nrk_init)
          (p &quot;init-rc&quot; &quot;nrk_resp&quot; z nrk_resp)
          (p &quot;init-rc&quot; &quot;SPIrk_init&quot; z SPIrk_init)
          (p &quot;init-rc&quot; &quot;SPIrk_resp&quot; z SPIrk_resp)
          (p &quot;init-rc&quot; &quot;SPIcc_init&quot; z SPIcc_init)
          (p &quot;init-rc&quot; &quot;SPIcc_resp&quot; z SPIcc_resp)
          (p &quot;init-rc&quot; &quot;ncc_init&quot; z ncc_init)
          (p &quot;init-rc&quot; &quot;ncc_resp&quot; z ncc_resp) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk) (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp)
          (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;gr&quot; z (exp (gen) r))
          (p &quot;init-rc&quot; &quot;grkr&quot; z (exp (gen) rkr))
          (p &quot;init-rc&quot; &quot;gccr&quot; z (exp (gen) ccr)) (p &quot;init-rc&quot; &quot;i&quot; z i)
          (p &quot;init-rc&quot; &quot;rki&quot; z rki) (p &quot;init-rc&quot; &quot;cci&quot; z cci) (non psk)
          (non ppk) (ugen SPI_init) (ugen n_init) (ugen SPI_init2)
          (ugen nrk_init) (ugen SPIrk_init) (ugen SPIcc_init)
          (ugen ncc_init))
        (exists ((SPI_init2-0 SPI_resp2-0 data) (rkr-0 rndx) (z-0 strd))
          (and (p &quot;resp-rc&quot; z-0 8) (p &quot;resp-rc&quot; &quot;SPI_init&quot; z-0 SPI_init)
            (p &quot;resp-rc&quot; &quot;SPI_resp&quot; z-0 SPI_resp)
            (p &quot;resp-rc&quot; &quot;n_init&quot; z-0 n_init)
            (p &quot;resp-rc&quot; &quot;n_resp&quot; z-0 n_resp)
            (p &quot;resp-rc&quot; &quot;SPI_init2&quot; z-0 SPI_init2-0)
            (p &quot;resp-rc&quot; &quot;SPI_resp2&quot; z-0 SPI_resp2-0)
            (p &quot;resp-rc&quot; &quot;nrk_init&quot; z-0 nrk_init)
            (p &quot;resp-rc&quot; &quot;nrk_resp&quot; z-0 nrk_resp)
            (p &quot;resp-rc&quot; &quot;SPIrk_init&quot; z-0 SPIrk_init)
            (p &quot;resp-rc&quot; &quot;SPIrk_resp&quot; z-0 SPIrk_resp)
            (p &quot;resp-rc&quot; &quot;SPIcc_init&quot; z-0 SPIcc_init)
            (p &quot;resp-rc&quot; &quot;SPIcc_resp&quot; z-0 SPIcc_resp)
            (p &quot;resp-rc&quot; &quot;ncc_init&quot; z-0 ncc_init)
            (p &quot;resp-rc&quot; &quot;ncc_resp&quot; z-0 ncc_resp)
            (p &quot;resp-rc&quot; &quot;psk&quot; z-0 psk) (p &quot;resp-rc&quot; &quot;ppk&quot; z-0 ppk)
            (p &quot;resp-rc&quot; &quot;ID_init&quot; z-0 ID_init)
            (p &quot;resp-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)
            (p &quot;resp-rc&quot; &quot;id_ppk&quot; z-0 id_ppk)
            (p &quot;resp-rc&quot; &quot;gi&quot; z-0 (exp (gen) i))
            (p &quot;resp-rc&quot; &quot;grki&quot; z-0
              (exp (gen) (mul rki rkr (rec rkr-0))))
            (p &quot;resp-rc&quot; &quot;gcci&quot; z-0 (exp (gen) cci))
            (p &quot;resp-rc&quot; &quot;r&quot; z-0 r) (p &quot;resp-rc&quot; &quot;rkr&quot; z-0 rkr-0)
            (p &quot;resp-rc&quot; &quot;ccr&quot; z-0 ccr) (prec z 0 z-0 0)
            (prec z 2 z-0 2) (prec z 4 z-0 4) (prec z 6 z-0 6)
            (prec z-0 1 z 1) (prec z-0 3 z 3) (prec z-0 5 z 5)
            (prec z-0 7 z 7) (ugen SPI_resp) (ugen n_resp)
            (ugen nrk_resp) (ugen SPIrk_resp) (ugen SPIcc_resp)
            (ugen ncc_resp) (ugen SPI_resp2-0) (fact peerID z ID_resp)
            (fact pskIDs psk ID_init ID_resp)
            (fact isKeyIDFor id_ppk ppk))))))
  (label 76)
  (unrealized (0 3) (0 7))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k84">Item <a href="#t76">84</a>, Parent: <a href="#k76">76</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 639.960 Q 92.940 639.960 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <path
   d='M 139.920 489.960 Q 92.940 489.960 45.960 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr-0) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr-0)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) (mul rkr (rec rkr-0) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) (mul rkr (rec rkr-0) rki))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <path
   d='M 39.960 564.960 Q 86.940 564.960 133.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rkr rki)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <path
   d='M 39.960 414.960 Q 86.940 414.960 133.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul r i))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) (mul rkr (rec rkr-0) rki))) (gcci (exp (gen) cci)) (r r) (rkr rkr-0) (ccr ccr))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki) (cci cci))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 84</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (ppk psk skey)
    (ID_init ID_resp id_ppk name) (rkr rkr-0 ccr r i rki cci rndx))
  (defstrand init-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r))
    (grkr (exp (gen) rkr)) (gccr (exp (gen) ccr)) (i i) (rki rki)
    (cci cci))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) (mul rkr (rec rkr-0) rki))) (gcci (exp (gen) cci))
    (r r) (rkr rkr-0) (ccr ccr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((0 6) (1 6))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 7) (0 7)))
  (non-orig ppk psk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_init2 nrk_init nrk_resp
    SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init ncc_resp
    SPI_resp2-0)
  (facts (peerID 0 ID_resp) (pskIDs psk ID_init ID_resp)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 init-rc 7)
    (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init-0
      (exp (gen) cci-0)
      (hash
        (cat
          (hash
            (prf ppk
              (hash
                (cat (prf (cat n_init n_resp) (exp (gen) (mul i-0 r)))
                  n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
            (exp (gen) (mul rki-0 rkr)) nrk_init nrk_resp) nrk_init
          nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (1 6))
  (label 84)
  (parent 76)
  (realized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
        (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
        (ID_resp ID_resp) (i i) (rki rki) (cci cci) (r r) (rkr rkr)
        (ccr ccr))))
  (origs))</pre>

<p id="t90">Tree <a href="#top">90</a>, POV <a href="#k90">90</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k96&quot;, &quot;_self&quot;)'>96</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k90&quot;, &quot;_self&quot;)'>90</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k90">Item <a href="#t90">90</a>, Child: <a href="#k96">96</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 90</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i rki cci r rkr ccr rndx))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
    ncc_resp)
  (goals
    (forall
      ((SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
         nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
         ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
        (i rki cci r rkr ccr rndx) (z strd))
      (implies
        (and (p &quot;resp-rc&quot; z 8) (p &quot;resp-rc&quot; &quot;SPI_init&quot; z SPI_init)
          (p &quot;resp-rc&quot; &quot;SPI_resp&quot; z SPI_resp)
          (p &quot;resp-rc&quot; &quot;n_init&quot; z n_init)
          (p &quot;resp-rc&quot; &quot;n_resp&quot; z n_resp)
          (p &quot;resp-rc&quot; &quot;SPI_init2&quot; z SPI_init2)
          (p &quot;resp-rc&quot; &quot;SPI_resp2&quot; z SPI_resp2)
          (p &quot;resp-rc&quot; &quot;nrk_init&quot; z nrk_init)
          (p &quot;resp-rc&quot; &quot;nrk_resp&quot; z nrk_resp)
          (p &quot;resp-rc&quot; &quot;SPIrk_init&quot; z SPIrk_init)
          (p &quot;resp-rc&quot; &quot;SPIrk_resp&quot; z SPIrk_resp)
          (p &quot;resp-rc&quot; &quot;SPIcc_init&quot; z SPIcc_init)
          (p &quot;resp-rc&quot; &quot;SPIcc_resp&quot; z SPIcc_resp)
          (p &quot;resp-rc&quot; &quot;ncc_init&quot; z ncc_init)
          (p &quot;resp-rc&quot; &quot;ncc_resp&quot; z ncc_resp) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk) (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp)
          (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;gi&quot; z (exp (gen) i))
          (p &quot;resp-rc&quot; &quot;grki&quot; z (exp (gen) rki))
          (p &quot;resp-rc&quot; &quot;gcci&quot; z (exp (gen) cci)) (p &quot;resp-rc&quot; &quot;r&quot; z r)
          (p &quot;resp-rc&quot; &quot;rkr&quot; z rkr) (p &quot;resp-rc&quot; &quot;ccr&quot; z ccr) (non psk)
          (non ppk) (ugen SPI_resp) (ugen n_resp) (ugen SPI_resp2)
          (ugen nrk_resp) (ugen SPIrk_resp) (ugen SPIcc_resp)
          (ugen ncc_resp))
        (exists ((SPI_init2-0 SPI_resp2-0 data) (z-0 strd))
          (and (p &quot;init-rc&quot; z-0 7) (p &quot;init-rc&quot; &quot;SPI_init&quot; z-0 SPI_init)
            (p &quot;init-rc&quot; &quot;SPI_resp&quot; z-0 SPI_resp)
            (p &quot;init-rc&quot; &quot;n_init&quot; z-0 n_init)
            (p &quot;init-rc&quot; &quot;n_resp&quot; z-0 n_resp)
            (p &quot;init-rc&quot; &quot;SPI_init2&quot; z-0 SPI_init2-0)
            (p &quot;init-rc&quot; &quot;SPI_resp2&quot; z-0 SPI_resp2-0)
            (p &quot;init-rc&quot; &quot;nrk_init&quot; z-0 nrk_init)
            (p &quot;init-rc&quot; &quot;nrk_resp&quot; z-0 nrk_resp)
            (p &quot;init-rc&quot; &quot;SPIrk_init&quot; z-0 SPIrk_init)
            (p &quot;init-rc&quot; &quot;SPIrk_resp&quot; z-0 SPIrk_resp)
            (p &quot;init-rc&quot; &quot;SPIcc_init&quot; z-0 SPIcc_init)
            (p &quot;init-rc&quot; &quot;SPIcc_resp&quot; z-0 SPIcc_resp)
            (p &quot;init-rc&quot; &quot;ncc_init&quot; z-0 ncc_init)
            (p &quot;init-rc&quot; &quot;ncc_resp&quot; z-0 ncc_resp)
            (p &quot;init-rc&quot; &quot;psk&quot; z-0 psk) (p &quot;init-rc&quot; &quot;ppk&quot; z-0 ppk)
            (p &quot;init-rc&quot; &quot;ID_init&quot; z-0 ID_init)
            (p &quot;init-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)
            (p &quot;init-rc&quot; &quot;id_ppk&quot; z-0 id_ppk)
            (p &quot;init-rc&quot; &quot;gr&quot; z-0 (exp (gen) r))
            (p &quot;init-rc&quot; &quot;grkr&quot; z-0 (exp (gen) rkr))
            (p &quot;init-rc&quot; &quot;gccr&quot; z-0 (exp (gen) ccr))
            (p &quot;init-rc&quot; &quot;i&quot; z-0 i) (p &quot;init-rc&quot; &quot;rki&quot; z-0 rki)
            (p &quot;init-rc&quot; &quot;cci&quot; z-0 cci) (fact peerID z ID_init)
            (fact pskIDs psk ID_init ID_resp)
            (fact isKeyIDFor id_ppk ppk))))))
  (label 90)
  (unrealized (0 2) (0 6))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k96">Item <a href="#t90">96</a>, Parent: <a href="#k90">90</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 564.960 Q 92.940 564.960 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) (mul rki rkr (rec rki-0))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) (mul rki rkr (rec rki-0)))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki-0) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki-0)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 86.940 489.960 133.920 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 86.940 339.960 133.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (ncc_init ncc_init) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) (mul rki rkr (rec rki-0)))) (i i) (rki rki-0) (cci cci))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 96</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (ppk psk skey)
    (ID_resp ID_init id_ppk name) (rki rkr ccr rki-0 cci i r rndx))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (defstrand init-rc 7 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (ncc_init ncc_init) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk)
    (gr (exp (gen) r)) (grkr (exp (gen) (mul rki rkr (rec rki-0))))
    (i i) (rki rki-0) (cci cci))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((0 5) (1 5)) ((1 0) (0 0))
    ((1 2) (0 2)) ((1 4) (0 4)) ((1 6) (0 6)))
  (non-orig ppk psk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 nrk_init nrk_resp
    SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init ncc_resp
    SPI_init2-0)
  (facts (peerID 1 ID_resp) (pskIDs psk ID_init ID_resp)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 resp-cr 4)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r)
      n_resp &quot;notify_useppk&quot; n_init
      (hmac ID_resp
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init
              n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) (1 3))
  (label 96)
  (parent 90)
  (realized)
  (shape)
  (satisfies
    (no (p &quot;init-rc&quot; &quot;SPIcc_resp&quot; z-0 SPIcc_resp) (SPI_init SPI_init)
      (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
      (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init)
      (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
      (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
      (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
      (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
      (ID_resp ID_resp) (i i) (rki rki) (cci cci) (r r) (rkr rkr)
      (ccr ccr) (z 0)))
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
        (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
        (ID_resp ID_resp) (i i) (rki rki) (cci cci) (r r) (rkr rkr)
        (ccr ccr))))
  (origs))</pre>

<p id="t100">Tree <a href="#top">100</a>, POV <a href="#k100">100</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k106&quot;, &quot;_self&quot;)'>106</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k100&quot;, &quot;_self&quot;)'>100</text>
  </svg></div>

<pre>(defprotocol ikev2_psk diffie-hellman
  (defrole init-rc
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grkr rki) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-rc
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat
                (hash
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;)
                  (exp grki rkr) nrk_init nrk_resp) nrk_init nrk_resp
                SPIrk_init SPIrk_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrole init-cr
    (vars (i rki cci rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gr grkr gccr base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (send
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init
          &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; gr n_resp
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                n_init &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i)
                  n_init &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
              n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; gr
                n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gr i)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
            (exp (gen) cci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init
              (exp (gen) cci))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp gccr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp gccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
            (exp (gen) rki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init
              (exp (gen) rki))
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            grkr
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              grkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gr i)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_init n_init SPI_init2 nrk_init SPIrk_init SPIcc_init
      ncc_init)
    (assume
      (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))
    (facts (isKeyIDFor id_ppk ppk)))
  (defrole resp-cr
    (vars (r rkr ccr rndx)
      (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
        nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
        ncc_resp data) (gi grki gcci base) (psk ppk skey)
      (ID_init ID_resp id_ppk name))
    (trace
      (recv
        (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
          &quot;notify_useppk&quot;))
      (send
        (cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r)
          n_resp &quot;notify_useppk&quot;))
      (recv
        (cat SPI_init SPI_resp &quot;msg3&quot;
          (enc ID_init
            (hash (hash psk &quot;KeyPadforIKEv2&quot;)
              (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                &quot;notify_useppk&quot;) n_resp
              (hmac ID_init
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
            &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat ID_init
              (hash (hash psk &quot;KeyPadforIKEv2&quot;)
                (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; gi n_init
                  &quot;notify_useppk&quot;) n_resp
                (hmac ID_init
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;)))
              &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;msg4&quot;
          (enc ID_resp
            (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
              (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
              (hmac ID_resp
                (prf ppk
                  (hash
                    (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                      n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
            &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat ID_resp
              (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot;
                (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init
                (hmac ID_resp
                  (prf ppk
                    (hash
                      (cat (prf (cat n_init n_resp) (exp gi r)) n_init
                        n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;)))
              &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac
            (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init gcci)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;create_child&quot;
          (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
            ncc_resp (exp (gen) ccr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp
              ncc_resp (exp (gen) ccr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;))))
      (recv
        (cat SPI_init SPI_resp &quot;rekey_init&quot;
          (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ei&quot;))
          (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init grki)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ai&quot;))))
      (send
        (cat SPI_init SPI_resp &quot;rekey_resp&quot;
          (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
            (exp (gen) rkr)
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;er&quot;))
          (hmac
            (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp
              (exp (gen) rkr))
            (hash
              (cat (prf (cat n_init n_resp) (exp gi r)) n_init n_resp
                SPI_init SPI_resp) &quot;ar&quot;)))))
    (non-orig psk ppk)
    (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
      ncc_resp)
    (facts (pskIDs psk ID_init ID_resp) (isKeyIDFor id_ppk ppk)))
  (defrule IDs_eq
    (forall ((ID_init1 ID_init2 ID_resp1 ID_resp2 name) (psk skey))
      (implies
        (and (fact pskIDs psk ID_init1 ID_resp1)
          (fact pskIDs psk ID_init2 ID_resp2))
        (and (= ID_init1 ID_init2) (= ID_resp1 ID_resp2)))))
  (defrule peerID_intro_rc
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_intro_cr
    (forall ((ID_init ID_resp name) (psk skey) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (fact pskIDs psk ID_init ID_resp))
        (fact peerID z ID_resp))))
  (defrule peerID_semantics_rc
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-rc&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule peerID_semantics_cr
    (forall ((ID_resp1 ID_resp2 name) (z strd))
      (implies
        (and (p &quot;init-cr&quot; &quot;ID_resp&quot; z ID_resp1)
          (fact peerID z ID_resp2))
        (= ID_resp1 ID_resp2))))
  (defrule id_ppk_inj1
    (forall ((id_ppk name) (ppk1 ppk2 skey))
      (implies
        (and (fact isKeyIDFor id_ppk ppk1)
          (fact isKeyIDFor id_ppk ppk2))
        (= ppk1 ppk2))))
  (defrule id_ppk_inj2
    (forall ((id_ppk1 id_ppk2 name) (ppk skey))
      (implies
        (and (fact isKeyIDFor id_ppk1 ppk)
          (fact isKeyIDFor id_ppk2 ppk))
        (= id_ppk1 id_ppk2))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule fact-init-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-rc-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 4)) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-rc-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-rc&quot; z (idx 3)) (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-init-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;init-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule fact-resp-cr-pskIDs1
    (forall ((z strd) (ID_resp ID_init name) (psk skey))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 4)) (p &quot;resp-cr&quot; &quot;psk&quot; z psk)
          (p &quot;resp-cr&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-cr&quot; &quot;ID_resp&quot; z ID_resp))
        (fact pskIDs psk ID_init ID_resp))))
  (defgenrule fact-resp-cr-isKeyIDFor0
    (forall ((z strd) (ppk skey) (id_ppk name))
      (implies
        (and (p &quot;resp-cr&quot; z (idx 3)) (p &quot;resp-cr&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-cr&quot; &quot;ppk&quot; z ppk)) (fact isKeyIDFor id_ppk ppk))))
  (defgenrule assume-init-rc-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-rc&quot; z (idx 3)) (p &quot;init-rc&quot; &quot;psk&quot; z psk)
          (p &quot;init-rc&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (defgenrule assume-init-cr-0
    (forall ((z strd) (ID_init name) (psk skey))
      (implies
        (and (p &quot;init-cr&quot; z (idx 3)) (p &quot;init-cr&quot; &quot;psk&quot; z psk)
          (p &quot;init-cr&quot; &quot;ID_init&quot; z ID_init))
        (exists ((ID_resp1 name)) (fact pskIDs psk ID_init ID_resp1)))))
  (lang (hmac hash) (prf hash)))</pre>

<p id="k100">Item <a href="#t100">100</a>, Child: <a href="#k106">106</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 100</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
    (i cci r rki rkr ccr rndx))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (non-orig psk ppk)
  (uniq-gen SPI_resp n_resp SPI_resp2 nrk_resp SPIrk_resp SPIcc_resp
    ncc_resp)
  (goals
    (forall
      ((SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
         nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
         ncc_resp data) (psk ppk skey) (ID_init id_ppk ID_resp name)
        (i cci r rki rkr ccr rndx) (z strd))
      (implies
        (and (p &quot;resp-rc&quot; z 8) (p &quot;resp-rc&quot; &quot;SPI_init&quot; z SPI_init)
          (p &quot;resp-rc&quot; &quot;SPI_resp&quot; z SPI_resp)
          (p &quot;resp-rc&quot; &quot;n_init&quot; z n_init)
          (p &quot;resp-rc&quot; &quot;n_resp&quot; z n_resp)
          (p &quot;resp-rc&quot; &quot;SPI_init2&quot; z SPI_init2)
          (p &quot;resp-rc&quot; &quot;SPI_resp2&quot; z SPI_resp2)
          (p &quot;resp-rc&quot; &quot;nrk_init&quot; z nrk_init)
          (p &quot;resp-rc&quot; &quot;nrk_resp&quot; z nrk_resp)
          (p &quot;resp-rc&quot; &quot;SPIrk_init&quot; z SPIrk_init)
          (p &quot;resp-rc&quot; &quot;SPIrk_resp&quot; z SPIrk_resp)
          (p &quot;resp-rc&quot; &quot;SPIcc_init&quot; z SPIcc_init)
          (p &quot;resp-rc&quot; &quot;SPIcc_resp&quot; z SPIcc_resp)
          (p &quot;resp-rc&quot; &quot;ncc_init&quot; z ncc_init)
          (p &quot;resp-rc&quot; &quot;ncc_resp&quot; z ncc_resp) (p &quot;resp-rc&quot; &quot;psk&quot; z psk)
          (p &quot;resp-rc&quot; &quot;ppk&quot; z ppk) (p &quot;resp-rc&quot; &quot;ID_init&quot; z ID_init)
          (p &quot;resp-rc&quot; &quot;ID_resp&quot; z ID_resp)
          (p &quot;resp-rc&quot; &quot;id_ppk&quot; z id_ppk)
          (p &quot;resp-rc&quot; &quot;gi&quot; z (exp (gen) i))
          (p &quot;resp-rc&quot; &quot;grki&quot; z (exp (gen) rki))
          (p &quot;resp-rc&quot; &quot;gcci&quot; z (exp (gen) cci)) (p &quot;resp-rc&quot; &quot;r&quot; z r)
          (p &quot;resp-rc&quot; &quot;rkr&quot; z rkr) (p &quot;resp-rc&quot; &quot;ccr&quot; z ccr) (non psk)
          (non ppk) (ugen SPI_resp) (ugen n_resp) (ugen SPI_resp2)
          (ugen nrk_resp) (ugen SPIrk_resp) (ugen SPIcc_resp)
          (ugen ncc_resp))
        (exists ((SPI_init2-0 SPI_resp2-0 data) (z-0 strd))
          (and (p &quot;init-rc&quot; z-0 7) (p &quot;init-rc&quot; &quot;SPI_init&quot; z-0 SPI_init)
            (p &quot;init-rc&quot; &quot;SPI_resp&quot; z-0 SPI_resp)
            (p &quot;init-rc&quot; &quot;n_init&quot; z-0 n_init)
            (p &quot;init-rc&quot; &quot;n_resp&quot; z-0 n_resp)
            (p &quot;init-rc&quot; &quot;SPI_init2&quot; z-0 SPI_init2-0)
            (p &quot;init-rc&quot; &quot;SPI_resp2&quot; z-0 SPI_resp2-0)
            (p &quot;init-rc&quot; &quot;nrk_init&quot; z-0 nrk_init)
            (p &quot;init-rc&quot; &quot;nrk_resp&quot; z-0 nrk_resp)
            (p &quot;init-rc&quot; &quot;SPIrk_init&quot; z-0 SPIrk_init)
            (p &quot;init-rc&quot; &quot;SPIrk_resp&quot; z-0 SPIrk_resp)
            (p &quot;init-rc&quot; &quot;SPIcc_init&quot; z-0 SPIcc_init)
            (p &quot;init-rc&quot; &quot;SPIcc_resp&quot; z-0 SPIcc_resp)
            (p &quot;init-rc&quot; &quot;ncc_init&quot; z-0 ncc_init)
            (p &quot;init-rc&quot; &quot;ncc_resp&quot; z-0 ncc_resp)
            (p &quot;init-rc&quot; &quot;psk&quot; z-0 psk) (p &quot;init-rc&quot; &quot;ppk&quot; z-0 ppk)
            (p &quot;init-rc&quot; &quot;ID_init&quot; z-0 ID_init)
            (p &quot;init-rc&quot; &quot;ID_resp&quot; z-0 ID_resp)
            (p &quot;init-rc&quot; &quot;id_ppk&quot; z-0 id_ppk)
            (p &quot;init-rc&quot; &quot;gr&quot; z-0 (exp (gen) r))
            (p &quot;init-rc&quot; &quot;gccr&quot; z-0 (exp (gen) ccr))
            (p &quot;init-rc&quot; &quot;i&quot; z-0 i) (p &quot;init-rc&quot; &quot;cci&quot; z-0 cci)
            (fact peerID z ID_init) (fact pskIDs psk ID_init ID_resp)
            (fact isKeyIDFor id_ppk ppk))))))
  (label 100)
  (unrealized (0 2) (0 6))
  (origs)
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k106">Item <a href="#t100">106</a>, Parent: <a href="#k100">100</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 564.960 Q 92.940 564.960 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) (mul rki rkr (rec rki-0))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) (mul rki rkr (rec rki-0)))) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki-0) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki-0)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2-0 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2-0 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_create_child_algorithms&quot; SPIcc_init SPIcc_resp ncc_resp (exp (gen) ccr)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;create_child&quot; (enc &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_create_child_algorithms&quot; SPIcc_init ncc_init (exp (gen) cci)) (hash (cat (hash (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;d&quot;) &quot;0x01&quot;) (exp (gen) (mul rki rkr)) nrk_init nrk_resp) nrk_init nrk_resp SPIrk_init SPIrk_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 86.940 489.960 133.920 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_resp&quot; (enc &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat &quot;SAr_rekey_algorithms&quot; SPIrk_init SPIrk_resp nrk_resp (exp (gen) rkr)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;rekey_init&quot; (enc &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat &quot;SAi_rekey_algorithms&quot; SPIrk_init nrk_init (exp (gen) rki)) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 86.940 339.960 133.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg4&quot; (enc ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot; (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;er&quot;)) (hmac (cat ID_resp (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot; n_init (hmac ID_resp (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) &quot;SAr2_algorithms&quot; SPI_resp2 &quot;use_ppk&quot;) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ar&quot;)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg3&quot; (enc ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ei&quot;)) (hmac (cat ID_init (hash (hash psk &quot;KeyPadforIKEv2&quot;) (cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;) n_resp (hmac ID_init (prf ppk (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;pi&quot;) &quot;0x01&quot;))) &quot;SAi2_algorithms&quot; SPI_init2 &quot;use_ppk&quot; id_ppk) (hash (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init n_resp SPI_init SPI_resp) &quot;ai&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat SPI_init SPI_resp &quot;msg2&quot; &quot;SAr1_algorithms&quot; (exp (gen) r) n_resp &quot;notify_useppk&quot;)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(cat SPI_init &quot;0&quot; &quot;msg1&quot; &quot;SAi1_algorithms&quot; (exp (gen) i) n_init &quot;notify_useppk&quot;)</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0) (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (ncc_init ncc_init) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gr (exp (gen) r)) (grkr (exp (gen) (mul rki rkr (rec rki-0)))) (i i) (rki rki-0) (cci cci))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>init-rc</text>
   </g>
  <g>
   <title>((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i)) (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr) (ccr ccr))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>resp-rc</text>
   </g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>ikev2_psk 106</text></svg></div>

<pre>(defskeleton ikev2_psk
  (vars
    (SPI_init SPI_resp n_init n_resp SPI_init2 SPI_resp2 nrk_init
      nrk_resp SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init
      ncc_resp SPI_init2-0 SPI_resp2-0 data) (ppk psk skey)
    (ID_resp ID_init id_ppk name) (rki rkr ccr rki-0 cci i r rndx))
  (defstrand resp-rc 8 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2)
    (SPI_resp2 SPI_resp2) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (SPIcc_resp SPIcc_resp) (ncc_init ncc_init)
    (ncc_resp ncc_resp) (psk psk) (ppk ppk) (ID_init ID_init)
    (ID_resp ID_resp) (id_ppk id_ppk) (gi (exp (gen) i))
    (grki (exp (gen) rki)) (gcci (exp (gen) cci)) (r r) (rkr rkr)
    (ccr ccr))
  (defstrand init-rc 7 (SPI_init SPI_init) (SPI_resp SPI_resp)
    (n_init n_init) (n_resp n_resp) (SPI_init2 SPI_init2-0)
    (SPI_resp2 SPI_resp2-0) (nrk_init nrk_init) (nrk_resp nrk_resp)
    (SPIrk_init SPIrk_init) (SPIrk_resp SPIrk_resp)
    (SPIcc_init SPIcc_init) (ncc_init ncc_init) (psk psk) (ppk ppk)
    (ID_init ID_init) (ID_resp ID_resp) (id_ppk id_ppk)
    (gr (exp (gen) r)) (grkr (exp (gen) (mul rki rkr (rec rki-0))))
    (i i) (rki rki-0) (cci cci))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((0 5) (1 5)) ((1 0) (0 0))
    ((1 2) (0 2)) ((1 4) (0 4)) ((1 6) (0 6)))
  (non-orig ppk psk)
  (uniq-gen SPI_init SPI_resp n_init n_resp SPI_resp2 nrk_init nrk_resp
    SPIrk_init SPIrk_resp SPIcc_init SPIcc_resp ncc_init ncc_resp
    SPI_init2-0)
  (facts (peerID 1 ID_resp) (pskIDs psk ID_init ID_resp)
    (isKeyIDFor id_ppk ppk))
  (rule fact-resp-cr-isKeyIDFor0 fact-resp-cr-pskIDs1 peerID_intro_cr)
  (operation encryption-test (displaced 2 0 resp-cr 4)
    (hash (hash psk &quot;KeyPadforIKEv2&quot;) &quot;SAr1_algorithms&quot; (exp (gen) r)
      n_resp &quot;notify_useppk&quot; n_init
      (hmac ID_resp
        (prf ppk
          (hash
            (cat (prf (cat n_init n_resp) (exp (gen) (mul i r))) n_init
              n_resp SPI_init SPI_resp) &quot;pr&quot;) &quot;0x01&quot;))) (1 3))
  (label 106)
  (parent 100)
  (realized)
  (shape)
  (satisfies
    (no (p &quot;init-rc&quot; &quot;SPIcc_resp&quot; z-0 SPIcc_resp) (SPI_init SPI_init)
      (SPI_resp SPI_resp) (n_init n_init) (n_resp n_resp)
      (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2) (nrk_init nrk_init)
      (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
      (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
      (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
      (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
      (ID_resp ID_resp) (i i) (cci cci) (r r) (rki rki) (rkr rkr)
      (ccr ccr) (z 0)))
  (maps
    ((0)
      ((SPI_init SPI_init) (SPI_resp SPI_resp) (n_init n_init)
        (n_resp n_resp) (SPI_init2 SPI_init2) (SPI_resp2 SPI_resp2)
        (nrk_init nrk_init) (nrk_resp nrk_resp) (SPIrk_init SPIrk_init)
        (SPIrk_resp SPIrk_resp) (SPIcc_init SPIcc_init)
        (SPIcc_resp SPIcc_resp) (ncc_init ncc_init) (ncc_resp ncc_resp)
        (psk psk) (ppk ppk) (ID_init ID_init) (id_ppk id_ppk)
        (ID_resp ID_resp) (i i) (cci cci) (r r) (rki rki) (rkr rkr)
        (ccr ccr))))
  (origs))</pre>

</body>
</html>
